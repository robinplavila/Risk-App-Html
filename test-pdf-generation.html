<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PDF Generation Test</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .form-section { display: none; margin: 20px 0; padding: 20px; border: 1px solid #ccc; }
        .form-section.active { display: block; }
        .form-section[data-section="1"] { display: block; }
        input, textarea, select { margin: 5px 0; }
        button { padding: 10px 20px; margin: 10px; }
        #results { margin-top: 20px; padding: 20px; background: #f5f5f5; }
    </style>
</head>
<body>
    <h1>PDF Generation Test</h1>
    
    <!-- Simulate form sections with some sample data -->
    <div class="form-section active" data-section="1">
        <h2>Section 1: Sectors</h2>
        <input type="checkbox" name="sectors[]" value="ai" id="ai" checked>
        <label for="ai">AI</label>
        <input type="checkbox" name="sectors[]" value="defi" id="defi">
        <label for="defi">DeFi</label>
    </div>
    
    <div class="form-section" data-section="2">
        <h2>Section 2: General Information</h2>
        <input type="text" name="legal_name" value="Test Company Inc.">
        <textarea name="mailing_address">123 Test Street, Test City, TC 12345</textarea>
        <input type="number" name="year_established" value="2020">
    </div>
    
    <div class="form-section" data-section="3">
        <h2>Section 3: Operations</h2>
        <textarea name="services_description">We provide AI software solutions</textarea>
        <input type="radio" name="sell_tangible_products" value="no" checked>
        <label>No tangible products</label>
    </div>
    
    <div class="form-section" data-section="14" id="ai-section">
        <h2>Section 14: AI Specialized Questions</h2>
        <input type="radio" name="ai_functionality_integrated" value="yes" checked>
        <label>AI functionality integrated: Yes</label>
        <textarea name="ai_functionality_description">Machine learning algorithms for data analysis</textarea>
    </div>
    
    <button onclick="testCollectFormData()">Test Form Data Collection</button>
    <button onclick="testPDFGeneration()">Test PDF Generation (Simulate)</button>
    
    <div id="results"></div>

    <script>
        // Simulate the collectFormData function with the fix
        function collectFormData() {
            const formData = {
                submissionDate: new Date().toLocaleDateString(),
                submissionTime: new Date().toLocaleTimeString(),
                sectors: [],
                generalInfo: {},
                operations: {},
                ai: {}
            };

            // Collect sectors (fixed selector)
            document.querySelectorAll('input[name="sectors[]"]:checked').forEach(function(input) {
                formData.sectors.push(input.value);
            });

            // Collect all form inputs by section (fixed selector)
            const sections = [
                { step: 2, key: 'generalInfo' },
                { step: 3, key: 'operations' }
            ];
            
            // Add AI section if enabled
            const aiStepEnabled = formData.sectors.includes('ai');
            if (aiStepEnabled) {
                const aiSection = document.querySelector('#ai-section');
                if (aiSection) {
                    const aiStep = aiSection.getAttribute('data-section');
                    if (aiStep) sections.push({ step: parseInt(aiStep), key: 'ai' });
                }
            }

            sections.forEach(section => {
                // Fixed selector: use .form-section[data-section="X"] instead of #stepX
                document.querySelectorAll(`.form-section[data-section="${section.step}"] input, .form-section[data-section="${section.step}"] textarea, .form-section[data-section="${section.step}"] select`).forEach(function(input) {
                    const name = input.getAttribute('name');
                    const type = input.getAttribute('type');
                    
                    if (name) {
                        if (type === 'checkbox') {
                            if (!formData[section.key][name]) {
                                formData[section.key][name] = [];
                            }
                            if (input.checked) {
                                formData[section.key][name].push(input.value);
                            }
                        } else if (type === 'radio') {
                            if (input.checked) {
                                formData[section.key][name] = input.value;
                            }
                        } else {
                            const value = input.value;
                            if (value && value.trim() !== '') {
                                formData[section.key][name] = value;
                            }
                        }
                    }
                });
            });

            return formData;
        }
        
        function testCollectFormData() {
            const formData = collectFormData();
            document.getElementById('results').innerHTML = '<h3>Collected Form Data:</h3><pre>' + JSON.stringify(formData, null, 2) + '</pre>';
        }
        
        function testPDFGeneration() {
            const formData = collectFormData();
            
            // Simulate the PDF content structure
            let pdfContent = 'PDF Content Structure:\n\n';
            
            pdfContent += 'HEADER:\nAxis Technology Insurance Application\n';
            pdfContent += `Submitted: ${formData.submissionDate} at ${formData.submissionTime}\n\n`;
            
            // Section 1: Sectors
            pdfContent += 'Section 1: Sectors\n';
            pdfContent += 'â€¢ Does your business provide products or services within any of the following sectors?\n';
            if (formData.sectors.length > 0) {
                const sectorLabels = {
                    'ai': 'ðŸ¤– Artificial Intelligence',
                    'defi': 'ðŸ’° Decentralized Finance & Digital Assets', 
                    'robotics': 'ðŸ¦¾ Autonomous Robotics'
                };
                const selectedSectors = formData.sectors.map(sector => sectorLabels[sector] || sector);
                pdfContent += `  Selected: ${selectedSectors.join(', ')}\n`;
            } else {
                pdfContent += '  No sectors selected\n';
            }
            pdfContent += '\n';
            
            // Helper function to add section data
            function addSectionData(sectionTitle, sectionData) {
                pdfContent += `${sectionTitle}\n`;
                
                if (Object.keys(sectionData).length === 0) {
                    pdfContent += 'No data entered for this section\n\n';
                    return;
                }
                
                const sortedEntries = Object.entries(sectionData).sort(([a], [b]) => a.localeCompare(b));
                
                sortedEntries.forEach(([key, value]) => {
                    if (value !== undefined && value !== null && value !== '') {
                        if (Array.isArray(value) && value.length === 0) {
                            return;
                        }
                        
                        let fieldName = key.replace(/_/g, ' ').replace(/([A-Z])/g, ' $1').toLowerCase();
                        fieldName = fieldName.charAt(0).toUpperCase() + fieldName.slice(1);
                        
                        let displayValue = value;
                        if (Array.isArray(value)) {
                            if (value.length > 0) {
                                displayValue = value.join(', ');
                            } else {
                                return;
                            }
                        }
                        
                        pdfContent += `â€¢ ${fieldName}:\n  ${displayValue}\n`;
                    }
                });
                pdfContent += '\n';
            }
            
            // Add all sections
            addSectionData('Section 2: General Information', formData.generalInfo);
            addSectionData('Section 3: Operations', formData.operations);
            
            // Conditional sections
            if (formData.sectors.includes('ai') && Object.keys(formData.ai).length > 0) {
                addSectionData('Section 14: Artificial Intelligence (Specialized Questions)', formData.ai);
            }
            
            document.getElementById('results').innerHTML = '<h3>Simulated PDF Content:</h3><pre>' + pdfContent + '</pre>';
        }
    </script>
</body>
</html>