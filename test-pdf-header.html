<!DOCTYPE html>
<html>
<head>
    <title>Test PDF Header</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .btn { background: #007bff; color: white; padding: 10px 20px; border: none; cursor: pointer; margin: 10px; }
        .btn:hover { background: #0056b3; }
    </style>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
</head>
<body>
    <h1>Test PDF Header Generation</h1>
    
    <button class="btn" onclick="testPDFHeader()">Generate Test PDF with Header</button>
    
    <div id="output"></div>
    
    <script>
        function testPDFHeader() {
            try {
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();
                
                let yPosition = 50; // Start below header area
                const pageHeight = doc.internal.pageSize.height;
                const margin = 20;
                const headerHeight = 45; // Space reserved for header
                const lineHeight = 6;
                
                // Helper function to add header to each page
                function addPageHeader(currentPageNum, totalPages) {
                    const pageWidth = doc.internal.pageSize.width;
                    
                    // Axis logo text (left side)
                    doc.setFontSize(16);
                    doc.setFont(undefined, 'bold');
                    doc.setTextColor(0, 100, 200); // Blue color for Axis
                    doc.text('AXIS', margin, 25);
                    
                    // Technology Risk Application | page number (right side)
                    doc.setFontSize(10);
                    doc.setFont(undefined, 'normal');
                    doc.setTextColor(0, 0, 0); // Black color for rest of text
                    const headerText = `Technology Risk Application | Page ${currentPageNum}`;
                    const textWidth = doc.getTextWidth(headerText);
                    doc.text(headerText, pageWidth - margin - textWidth, 25);
                    
                    // Blue border line at bottom of header
                    doc.setDrawColor(0, 100, 200); // Blue color
                    doc.setLineWidth(2);
                    doc.line(margin, 35, pageWidth - margin, 35);
                    
                    // Reset text color to black for content
                    doc.setTextColor(0, 0, 0);
                }
                
                // Helper function to add new page if needed
                function checkPageBreak(additionalHeight = 15) {
                    if (yPosition + additionalHeight > pageHeight - margin) {
                        doc.addPage();
                        yPosition = headerHeight + 5; // Start below header
                    }
                }
                
                // Helper function to add text with word wrapping
                function addWrappedText(text, x, fontSize = 10, maxWidth = 170) {
                    doc.setFontSize(fontSize);
                    const splitText = doc.splitTextToSize(text, maxWidth);
                    splitText.forEach(line => {
                        checkPageBreak();
                        doc.text(line, x, yPosition);
                        yPosition += lineHeight;
                    });
                }
                
                // Document info section
                doc.setFontSize(10);
                doc.setFont(undefined, 'normal');
                doc.text(`Submitted: ${new Date().toLocaleDateString()} at ${new Date().toLocaleTimeString()}`, margin, yPosition);
                yPosition += 15;
                
                // Add test content to demonstrate multiple pages
                doc.setFontSize(14);
                doc.setFont(undefined, 'bold');
                addWrappedText('Test Document with Header', margin);
                yPosition += 10;
                
                doc.setFontSize(10);
                doc.setFont(undefined, 'normal');
                
                // Add enough content to create multiple pages
                for (let i = 1; i <= 50; i++) {
                    checkPageBreak(20);
                    addWrappedText(`Section ${i}: This is test content to demonstrate the header functionality. Each section contains multiple lines of text to show how the header appears on each page. The header should include the AXIS logo on the left, the application title and page number on the right, and a blue border at the bottom.`, margin);
                    yPosition += 10;
                }
                
                // Add headers and footers to all pages
                const pageCount = doc.internal.getNumberOfPages();
                for (let i = 1; i <= pageCount; i++) {
                    doc.setPage(i);
                    
                    // Add header to each page
                    addPageHeader(i, pageCount);
                    
                    // Add footer to each page
                    doc.setFontSize(8);
                    doc.setFont(undefined, 'normal');
                    doc.setTextColor(0, 0, 0); // Ensure footer text is black
                    doc.text(`Page ${i} of ${pageCount}`, doc.internal.pageSize.width - 40, doc.internal.pageSize.height - 10);
                    doc.text('Axis Technology Insurance Application', margin, doc.internal.pageSize.height - 10);
                }
                
                // Save the PDF
                const timestamp = new Date().toISOString().slice(0,19).replace(/:/g,'-');
                const filename = `Test-PDF-Header-${timestamp}.pdf`;
                doc.save(filename);
                
                document.getElementById('output').innerHTML = `
                    <h2>✅ PDF Generated Successfully!</h2>
                    <p><strong>File:</strong> ${filename}</p>
                    <p><strong>Pages:</strong> ${pageCount}</p>
                    <p><strong>Header Features:</strong></p>
                    <ul>
                        <li>AXIS logo in blue on the left side</li>
                        <li>"Technology Risk Application | Page X" on the right side</li>
                        <li>Blue border line at the bottom of the header</li>
                        <li>Dynamic page numbering</li>
                        <li>Consistent header on all ${pageCount} pages</li>
                    </ul>
                    <p>Check your downloads folder for the PDF file.</p>
                `;
                
            } catch (error) {
                console.error('Error generating PDF:', error);
                document.getElementById('output').innerHTML = `
                    <h2>❌ Error generating PDF</h2>
                    <p>${error.message}</p>
                `;
            }
        }
    </script>
</body>
</html>